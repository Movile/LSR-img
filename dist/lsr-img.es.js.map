{"version":3,"file":"lsr-img.es.js","sources":["../src/lsr-img.js"],"sourcesContent":["/* ===========================================================\n * lsr-img.js v0.1\n * http://jeremiahalex.github.com\n *\n * Web previewer for Apple's Layer Source Representation (LSR) Image format.\n * Requires\n * - JSZip\n *\n * ===========================================================\n * Copyright 2015 Jeremiah Alexander (@JeremiahAlex)\n *\n * Licensed under the MIT license.\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ========================================================== */\nimport { version } from '../package.json';\nimport JSZip from 'jszip';\nimport highlightImage from './statics/lsr-highlight.png';\n\nlet falsy = /^(?:f(?:alse)?|no?|0+)$/i;\n\nfunction isTrue (value) {\n  return !falsy.test(value) && !!value;\n}\n\nfunction getWidth (element) {\n  return element.getBoundingClientRect().width > 0 ?\n    element.getBoundingClientRect().width :\n    parseInt(window.getComputedStyle(element).width);\n}\n\nfunction getHeight (element) {\n  return element.getBoundingClientRect().height > 0 ?\n    element.getBoundingClientRect().height :\n    parseInt(window.getComputedStyle(element).height);\n}\n\nexport function LSRImg (loadOnDemand = false) {\n\n  let lsrImages = [];\n  let lsrImgElements = [];\n  let lsrHighlightImagePath = null;\n  let focussedLsrCanvas = null;\n  let lsrHighlightImage = highlightImage;\n  let lsrShadowPadding = 50;\n  let lsrFocussedPadding = 35;\n  let lsrResizeTimer;\n  let lsrMinAngleX = -10;\n  let lsrMinAngleY = -10;\n  let lsrAngleYCorrector = 1;\n  let lsrAngleRange = 20;\n  let lsrDeviceOrientation = null;\n  let lsrAxisTable = {\n    landscape: {\n      x: 'gamma', y: 'beta', z: 'alpha',\n    }, landscapeInverse: {\n      x: 'gamma', y: 'beta', z: 'alpha',\n    }, portrait: {\n      x: 'beta', y: 'gamma', z: 'alpha',\n    },\n  };\n  let onloadCallback = emptyOnload;\n\n  function emptyOnload () {}\n\n\n  /*------------------------------\n    Initialize -\n  ------------------------------*/\n  // create a highlight image\n  if (lsrHighlightImagePath !== null) {\n    lsrHighlightImage = new Image();\n    lsrHighlightImage.src = lsrHighlightImagePath;\n  }\n\n  // check if device rotation is supported\n  if (window.DeviceOrientationEvent) {\n    window.addEventListener('orientationchange', lsrOrientationChange, false);\n    window.addEventListener('deviceorientation', lsrOrientationUpdate, false);\n  }\n\n  // catch resize events but not too often\n  window.onresize = function () {\n    if (lsrResizeTimer) {\n      clearTimeout(lsrResizeTimer);\n    }\n    lsrResizeTimer = setTimeout(resizeLSRCanvases, 500);\n  };\n\n  if (!loadOnDemand) {\n    document.onreadystatechange = function () {\n      if (document.readyState === 'complete') {\n        let lsrImgElements = document.getElementsByClassName('lsr-img');\n        for (let lsrImgElement of lsrImgElements) {\n          loadLSRFile(lsrImgElement);\n        }\n      }\n    };\n  }\n\n  function load (elementOrId) {\n    if (loadOnDemand) {\n      if (typeof elementOrId === 'string') {\n        let lsrElement = document.getElementById(elementOrId);\n        if (lsrElement !== null) {\n          elementOrId = lsrElement;\n        } else {\n          console.log('LSR-img: the element identified with ID: ' + elementOrId + ', was not found.');\n          return;\n        }\n      }\n\n      if (lsrImgElements.indexOf(elementOrId) !== -1) {\n        removeLsrImage(elementOrId);\n      }\n      else {\n        lsrImgElements.push(elementOrId);\n      }\n\n      loadLSRFile(elementOrId);\n    } else {\n      console.log('LSR-img: load on demand is disable.');\n    }\n  }\n\n  function resizeLSRCanvases () {\n    for (let i = 0; i < lsrImages.length; i++) {\n      if (lsrImages[i].responsive && lsrImages[i].canvas.parentElement.getBoundingClientRect().width > 0 &&\n        lsrImages[i].canvas.parentElement.getBoundingClientRect().height > 0\n      ) {\n        resizeLSRCanvas(lsrImages[i]);\n      }\n    }\n  }\n\n  function resizeLSRCanvas (lsrImage) {\n    let ratio = lsrImage.canvasSize.width / lsrImage.canvasSize.height;\n\n    //we scale the css, so we don't need to redo the canvas content\n    lsrImage.canvas.style.width = getWidth(lsrImage.canvas.parentElement) + 'px';\n    lsrImage.canvas.style.height = (getWidth(lsrImage.canvas.parentElement) / ratio) + 'px';\n  }\n\n  /*------------------------------\n    File Loading -\n  ------------------------------*/\n  function loadLSRFile (element) {\n    //grab the lsr-image name from the div\n    let dataAttribute = element.dataset.imageSrc;\n    if (dataAttribute === null) {\n      console.log('LSR-img: data-image-src attribute not found on lsr-img classed object');\n      return;\n    }\n    let filename = String(dataAttribute);\n\n    //if the filename isn't absolute then, then take the window's location for the relative path\n    if (filename.indexOf('http') === -1) {\n      let filePath = String(window.location);\n      filePath = filePath.substr(0, filePath.lastIndexOf('/') + 1);\n      filename = filePath + filename;\n    }\n\n    let xhr = new XMLHttpRequest();\n    xhr.open('GET', filename, true);\n    xhr.responseType = 'blob';\n    xhr.onload = function () {\n      if (this.status === 200) {\n        let fileBlob = new Blob([this.response], {type: 'application/zip'});\n        unzipLSRFile(fileBlob, function (lsrImage) {\n          //obtain the settings for this image\n          dataAttribute = element.dataset.rounded;\n          if (typeof dataAttribute === 'undefined') lsrImage.roundedCorners = false; else lsrImage.roundedCorners =\n            isTrue(dataAttribute);\n          //shadows\n          dataAttribute = element.dataset.shadows;\n          if (typeof dataAttribute === 'undefined') lsrImage.drawShadows = true; else lsrImage.drawShadows =\n            isTrue(dataAttribute);\n          //animate\n          dataAttribute = element.dataset.animate;\n          if (typeof dataAttribute === 'undefined') lsrImage.animate = false; else lsrImage.animate =\n            isTrue(dataAttribute);\n          //focussed\n          dataAttribute = element.dataset.zoom;\n          if (typeof dataAttribute === 'undefined') lsrImage.zoomEnabled = true; else lsrImage.zoomEnabled =\n            isTrue(dataAttribute);\n          //responsive\n          dataAttribute = element.dataset.responsive;\n          if (typeof dataAttribute === 'undefined') lsrImage.responsive = false; else lsrImage.responsive =\n            isTrue(dataAttribute);\n\n          //display the image\n          displayLSRImage(lsrImage, element);\n          onloadCallback();\n        });\n      }\n    };\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState === XMLHttpRequest.DONE) {\n        if (xhr.status !== 200) {\n          console.log('LSR-img: The following LSR file could not be loaded: ' + filename);\n        }\n      }\n    };\n\n    xhr.send();\n  }\n\n  function unzipLSRFile (blob, successCallback) {\n    JSZip.loadAsync(blob).then(function (zip) {\n      //find out the lsr file content\n      zip.file('Contents.json').async('string').then(function success (content) {\n        let lsrImage = JSON.parse(content);\n        lsrImages.push(lsrImage);\n        lsrImage.layersLoading = lsrImage.layers.length;\n        for (let i = 0; i < lsrImage.layers.length; i++) {\n          openLSRLayer(lsrImage.layers[i], zip, function (success) {\n            lsrImage.layersLoading--;\n            if (!success)\n              console.log('LSR-img: One or more errors attempting to load lsr layer: ' + lsrImage.layers[i].filename);\n\n            if (lsrImage.layersLoading === 0) {\n              successCallback(lsrImage);\n            }\n          });\n        }\n      }, function error () {\n        console.log('LSR-Img: Failed to get Content.json');\n      });\n    }, function (message) {\n      console.log('LSR-img: Failed to unzip the LSR file: ' + message);\n    });\n  }\n\n  function openLSRLayer (lsrImageLayer, zip, successCallback) {\n    zip.file(lsrImageLayer.filename + '/Contents.json').async('string').then(function (content) {\n      let json = JSON.parse(content);\n      lsrImageLayer.info = json.info;\n      lsrImageLayer.properties = json.properties;\n      openLSRImageSet(lsrImageLayer, zip, successCallback);\n    });\n  }\n\n  function openLSRImageSet (lsrImageLayer, zip, successCallback) {\n    let entryName = lsrImageLayer.filename + '/Content.imageset/Contents.json';\n    zip.file(entryName).async('string').then(function (content) {\n      let json = JSON.parse(content);\n      lsrImageLayer.images = json.images;\n      //currently only one image set available\n      if (lsrImageLayer.images.length > 0) {\n        openImage(lsrImageLayer.images[0],\n          lsrImageLayer.filename + '/Content.imageset/' + lsrImageLayer.images[0].filename, zip, successCallback);\n      } else {\n        console.log('LSR-img: No Images specified in the layer: ' + entryName);\n        successCallback(false);\n      }\n    });\n  }\n\n  function openImage (lsrLayerImage, entryName, zip, successCallback) {\n    let ext = entryName.substr(entryName.lastIndexOf('.') + 1);\n    if (ext.match(/(jpg|jpeg|png|gif)$/)) {\n      let mimeType = 'image/' + ext;\n      zip.file(entryName).async('base64').then(function (content) {\n        lsrLayerImage.fileData = 'data:' + mimeType + ';base64,' + content;\n        successCallback(true);\n      });\n    } else {\n      console.log('LSR-img: Layered Image had an unsupported File Type: ' + entryName);\n      successCallback(false);\n    }\n  }\n\n  /*------------------------------\n    Image Display -\n  ------------------------------*/\n  function displayLSRImage (lsrImage, element) {\n    lsrImage.canvasResizeRatio = 1.0;\n    if (lsrImage.responsive) {\n      let wRatio = lsrImage.properties.canvasSize.width / getWidth(element);\n      let hRatio = lsrImage.properties.canvasSize.height / getHeight(element);\n      lsrImage.canvasResizeRatio = wRatio > hRatio ? wRatio : hRatio;\n    }\n\n    //for rendering we add padding to the canvas size for shadows and centering on focus\n    lsrImage.canvasSize = {\n      width: lsrImage.properties.canvasSize.width + (lsrShadowPadding * 2 * lsrImage.canvasResizeRatio),\n      height: lsrImage.properties.canvasSize.height + (lsrShadowPadding * 2 * lsrImage.canvasResizeRatio),\n    };\n\n    let canvas = document.createElement('canvas');\n    canvas.setAttribute('class', 'lsr-canvas');\n    canvas.setAttribute('width', lsrImage.canvasSize.width / lsrImage.canvasResizeRatio);\n    canvas.setAttribute('height', lsrImage.canvasSize.height / lsrImage.canvasResizeRatio);\n    lsrImage.canvas = canvas;\n\n    //create a canvas to render the shadow on\n    let shadowCanvas = document.createElement('canvas');\n    shadowCanvas.setAttribute('width', lsrImage.canvasSize.width / lsrImage.canvasResizeRatio);\n    shadowCanvas.setAttribute('height', lsrImage.canvasSize.height / lsrImage.canvasResizeRatio);\n    lsrImage.shadowCanvas = shadowCanvas;\n    lsrImage.shadowCtx = lsrImage.shadowCanvas.getContext('2d');\n\n    lsrImage.properties.canvasCentre = {};\n    lsrImage.properties.canvasCentre.x = lsrImage.properties.canvasSize.width * 0.5;\n    lsrImage.properties.canvasCentre.y = lsrImage.properties.canvasSize.height * 0.5;\n\n    lsrImage.focussedSize = {};\n    lsrImage.unfocussedSize = {};\n    let unfocusedReduction = lsrFocussedPadding * 2;\n    let aspectRatio = lsrImage.properties.canvasSize.width / lsrImage.properties.canvasSize.height;\n    if (lsrImage.properties.canvasSize.width > lsrImage.properties.canvasSize.height) {\n      lsrImage.focussedSize.width = lsrImage.properties.canvasSize.width / 1.06;\n      lsrImage.unfocussedSize.width = lsrImage.focussedSize.width - unfocusedReduction;\n\n      lsrImage.focussedSize.height = lsrImage.focussedSize.width / aspectRatio;\n      lsrImage.unfocussedSize.height = lsrImage.unfocussedSize.width / aspectRatio;\n      lsrImage.focussedScale = 1 / lsrImage.properties.canvasSize.width * lsrImage.focussedSize.width;\n      lsrImage.unfocussedScale = 1 / lsrImage.properties.canvasSize.width * lsrImage.unfocussedSize.width;\n    } else {\n      lsrImage.focussedSize.height = lsrImage.properties.canvasSize.height / 1.06;\n      lsrImage.unfocussedSize.height = lsrImage.focussedSize.height - unfocusedReduction;\n\n      lsrImage.focussedSize.width = lsrImage.focussedSize.height * aspectRatio;\n      lsrImage.unfocussedSize.width = lsrImage.unfocussedSize.height * aspectRatio;\n      lsrImage.focussedScale = 1 / lsrImage.properties.canvasSize.height * lsrImage.focussedSize.height;\n      lsrImage.unfocussedScale = 1 / lsrImage.properties.canvasSize.height * lsrImage.unfocussedSize.height;\n    }\n    lsrImage.focussedOffset = {};\n    lsrImage.focussedOffset.x = (lsrImage.canvasSize.width - lsrImage.focussedSize.width) * 0.5;\n    lsrImage.focussedOffset.y = (lsrImage.canvasSize.height - lsrImage.focussedSize.height) * 0.5;\n    lsrImage.unfocussedOffset = {};\n    lsrImage.unfocussedOffset.x = (lsrImage.canvasSize.width - lsrImage.unfocussedSize.width) * 0.5;\n    lsrImage.unfocussedOffset.y = (lsrImage.canvasSize.height - lsrImage.unfocussedSize.height) * 0.5;\n\n    lsrImage.ctx = lsrImage.canvas.getContext('2d');\n\n    let loadCount = 0;\n    for (let i = 0; i < lsrImage.layers.length; i++) {\n      let img = new Image();\n      lsrImage.layers[i].img = img;\n      img.onload = function () {\n        ++loadCount;\n        if (loadCount === lsrImage.layers.length) {\n\n          //hide the placeholder image now that we have our canvas\n          element.appendChild(lsrImage.canvas);\n          drawLSRImage(lsrImage, 0, 0);\n          for (let placeholder of element.getElementsByClassName('lsr-placeholder')) {\n            placeholder.style.display = 'none';\n          }\n          if (lsrImage.responsive) resizeLSRCanvas(lsrImage);\n          if (lsrImage.animate) animateLSRImage((new Date()).getTime(), lsrImage);\n        }\n      };\n      //for now all LSR images only have 1 image per layer, so load index 0\n      img.src = lsrImage.layers[i].images[0].fileData;\n    }\n\n    if (!lsrImage.animate) {\n      lsrImage.canvas.onmouseenter = function () {\n        if (!lsrImage.focussed) {\n          lsrImage.focussed = true;\n          if (focussedLsrCanvas !== null) {\n            focussedLsrCanvas.focussed = false;\n            drawLSRImage(focussedLsrCanvas, 0, 0);\n            resetLSRCanvasRotation(focussedLsrCanvas);\n            focussedLsrCanvas.canvas.removeEventListener('mousemove', mouseMoveOverFocusedLSRImage);\n          }\n          focussedLsrCanvas = lsrImage;\n          focussedLsrCanvas.canvas.onmousemove = mouseMoveOverFocusedLSRImage;\n\n          drawLSRImage(lsrImage, 0, 0);\n        }\n      };\n      lsrImage.canvas.onmouseleave = function () {\n        if (lsrImage.focussed) {\n          focussedLsrCanvas = null;\n          lsrImage.focussed = false;\n          lsrImage.canvas.removeEventListener('mousemove', mouseMoveOverFocusedLSRImage);\n\n          drawLSRImage(lsrImage, 0, 0);\n          resetLSRCanvasRotation(lsrImage);\n        }\n      };\n\n      if (window.DeviceOrientationEvent) {\n        //make it auto focussed for now by disabling zoom. in the future we could extend to be based on scroll visability\n        lsrImage.zoomEnabled = false;\n      }\n    }\n  }\n\n  let requestLSRAnimFrame = (function () {\n    return window.requestAnimationFrame ||\n      window.webkitRequestAnimationFrame ||\n      window.mozRequestAnimationFrame ||\n      window.oRequestAnimationFrame ||\n      window.msRequestAnimationFrame ||\n      function (callback) {\n        window.setTimeout(callback, 1000 / 60);\n      };\n  })();\n\n  function animateLSRImage (startTime, lsrImage) {\n    if (!lsrImage.focussed) lsrImage.focussed = true;\n\n    let time = (new Date()).getTime() - startTime;\n\n    // let speed = 500;\n    let theta = time / 500;\n\n    let relX = Math.cos(theta);\n    let relY = Math.sin(theta);\n\n    //TODO- there is duplication across a few of used thse poisitioning functions, so they should be a refactored\n    let rotateAroundX = -relX;\n    let rotateAroundY = relY;\n\n    let panX = -relX;\n    let panY = relY;\n\n    drawLSRImage(lsrImage, panX, panY);\n    rotateLSRCanvas(lsrImage, rotateAroundX, rotateAroundY);\n\n    requestLSRAnimFrame(function () {\n      animateLSRImage(startTime, lsrImage);\n    });\n  }\n\n  function resetLSRCanvasRotation (lsrImage) {\n    rotateLSRCanvas(lsrImage, 0, 0);\n  }\n\n  function lsrClamp (val, min, max) {\n    if (val > max) return max;\n    if (val < min) return min;\n    return val;\n  }\n\n  function lsrOrientationChange () {\n    if (window.orientation === 0) {\n      lsrDeviceOrientation = 'portrait';\n      lsrAngleRange = 20;\n      lsrMinAngleY = -10;\n    } else {\n      //less rotation on landscape\n      lsrDeviceOrientation = window.orientation === -90 ? 'landscapeInverse' : 'landscape';\n      lsrAngleRange = 10;\n      lsrMinAngleY = -5;\n    }\n\n    lsrMinAngleX = window.orientation === 90 ? lsrMinAngleY - 45 : lsrMinAngleY + 45;\n    lsrAngleYCorrector = window.orientation === -90 ? -1 : 1;\n  }\n\n  function lsrOrientationUpdate (e) {\n    if (lsrDeviceOrientation == null) lsrOrientationChange(null);\n\n    let x = e[lsrAxisTable[lsrDeviceOrientation].x];\n    let y = e[lsrAxisTable[lsrDeviceOrientation].y] * lsrAngleYCorrector;\n\n    let relX = lsrClamp((x - lsrMinAngleX) / lsrAngleRange, 0, 1);\n    let relY = lsrClamp((y - lsrMinAngleY) / lsrAngleRange, 0, 1);\n\n    let rotateAroundX = relX * 2 - 1;\n    let rotateAroundY = relY * 2 - 1;\n    let panX = relY * 2 - 1;\n    let panY = relX * 2 - 1;\n\n    for (let n = 0; n < lsrImages.length; n++) {\n      drawLSRImage(lsrImages[n], panX, panY);\n      rotateLSRCanvas(lsrImages[n], -rotateAroundX, rotateAroundY);\n    }\n  }\n\n  function mouseMoveOverFocusedLSRImage (e) {\n    let parentRect = focussedLsrCanvas.canvas.getBoundingClientRect();\n    let relX = e.pageX - parentRect.left;\n    let relY = e.pageY - parentRect.top;\n\n    relX = 1 / parentRect.width * relX;\n    relY = 1 / parentRect.height * relY;\n\n    let rotateAroundX = relY * 2 - 1;\n    let rotateAroundY = relX * 2 - 1;\n\n    let panX = 1 - relX * 2;\n    let panY = 1 - relY * 2;\n\n    drawLSRImage(focussedLsrCanvas, panX, panY);\n    rotateLSRCanvas(focussedLsrCanvas, rotateAroundX, -rotateAroundY);\n  }\n\n  function rotateLSRCanvas (lsrImage, degreeX, degreeY) {\n    let perspective = 0;\n\n    if (degreeX !== 0 || degreeY !== 0) perspective = 1000;\n\n    degreeX *= 3;\n    degreeY *= 3;\n\n    let parentCSS = lsrImage.canvas.parentElement.style;\n    parentCSS['-webkit-perspective'] = perspective + 'px';\n    parentCSS['-moz-perspective'] = perspective + 'px';\n    parentCSS['-ms-perspective'] = perspective + 'px';\n    parentCSS['-o-perspective'] = perspective + 'px';\n    parentCSS['-perspective'] = perspective + 'px';\n\n    let canvasCSS = lsrImage.canvas.style;\n    canvasCSS['-webkit-transform'] = ' rotateY(' + degreeY + 'deg)' + ' rotateX(' + degreeX + 'deg)';\n    canvasCSS['-moz-transform'] = ' rotateY(' + degreeY + 'deg)' + ' rotateX(' + degreeX + 'deg)';\n    canvasCSS['-ms-transform'] = ' rotateY(' + degreeY + 'deg)' + ' rotateX(' + degreeX + 'deg)';\n    canvasCSS['-o-transform'] = ' rotateY(' + degreeY + 'deg)' + ' rotateX(' + degreeX + 'deg)';\n    canvasCSS['-transform'] = ' rotateY(' + degreeY + 'deg)' + ' rotateX(' + degreeX + 'deg)';\n  }\n\n  //TODO. lots of opportunity for optimisation in this function\n  function drawLSRImage (lsrImage, relX, relY) {\n    lsrImage.ctx.clearRect(0, 0, lsrImage.canvasSize.width / lsrImage.canvasResizeRatio,\n      lsrImage.canvasSize.height / lsrImage.canvasResizeRatio);\n    lsrImage.ctx.globalCompositeOperation = 'source-over';\n\n    let focusScale;\n    let focusOffset = {};\n    if (lsrImage.focussed || !lsrImage.zoomEnabled) {\n      focusScale = lsrImage.focussedScale;\n      focusOffset.x = lsrImage.focussedOffset.x;\n      focusOffset.y = lsrImage.focussedOffset.y;\n    } else {\n      focusScale = lsrImage.unfocussedScale;\n      focusOffset.x = lsrImage.unfocussedOffset.x;\n      focusOffset.y = lsrImage.unfocussedOffset.y;\n    }\n\n    let max = lsrImage.layers.length - 1;\n    let scalePerLayer = 0.06 / max;\n\n    // TODO: turning off image smoothing sharpens the image but creates lines in animation and poor resuls when scaling, to invesitgate\n    // lsrImage.ctx.mozImageSmoothingEnabled = false;\n    // lsrImage.ctx.webkitImageSmoothingEnabled = false;\n    // lsrImage.ctx.msImageSmoothingEnabled = false;\n    // lsrImage.ctx.imageSmoothingEnabled = false;\n\n    for (let i = max; i >= 0; --i) {\n      let x = focusOffset.x, y = focusOffset.y;\n      let sizeScale = focusScale;\n\n      //TODO. the default value should probably be calculated as a proportion of the width/height or padding\n      let panOffset = {x: relX * 15, y: relY * 10};\n\n      //increase the scale for each layer\n      if (lsrImage.focussed || !lsrImage.zoomEnabled) sizeScale += (max - i) * scalePerLayer;\n\n      let width = lsrImage.layers[i].properties['frame-size'].width * sizeScale;\n      let height = lsrImage.layers[i].properties['frame-size'].height * sizeScale;\n\n      if (typeof lsrImage.layers[i].properties['frame-center'] !== 'undefined') {\n        x += lsrImage.layers[i].properties['frame-center'].x * focusScale;\n        y += lsrImage.layers[i].properties['frame-center'].y * focusScale;\n      } else {\n        x += lsrImage.properties.canvasCentre.x * focusScale;\n        y += lsrImage.properties.canvasCentre.y * focusScale;\n      }\n\n      //as we move up the layers the further from the center, the more pronounced the move\n      if (lsrImage.focussed || !lsrImage.zoomEnabled) {\n        let distfromCenter = {\n          x: lsrImage.properties.canvasCentre.x - lsrImage.layers[i].properties['frame-center'].x,\n          y: lsrImage.properties.canvasCentre.y - lsrImage.layers[i].properties['frame-center'].y,\n        };\n\n        //TODO. these numbers seem to work, would be good to have a better rationale behind them though\n        x -= distfromCenter.x * 0.03 * (max - i);\n        y -= distfromCenter.y * 0.03 * (max - i);\n\n        panOffset.x += (lsrImage.canvasSize.width * 0.003) * i * relX;\n        panOffset.y += (lsrImage.canvasSize.width * 0.003) * i * relY;\n      }\n\n      // adjust with the pan\n      x -= width * 0.5 + panOffset.x;\n      y -= height * 0.5 + panOffset.y;\n\n      width /= lsrImage.canvasResizeRatio;\n      height /= lsrImage.canvasResizeRatio;\n      x /= lsrImage.canvasResizeRatio;\n      y /= lsrImage.canvasResizeRatio;\n\n      lsrImage.ctx.drawImage(lsrImage.layers[i].img, x, y, width, height);\n    }\n\n    // calculate baseRect take into account the lsrImage.canvasSize.\n    let panOffset = {x: relX * 15, y: relY * 10};\n    if (lsrImage.focussed || !lsrImage.zoomEnabled) {\n      panOffset.x += (lsrImage.canvasSize.width * 0.003) * max * relX;\n      panOffset.y += (lsrImage.canvasSize.width * 0.003) * max * relY;\n    }\n    let baseRect = {};\n    baseRect.width = lsrImage.properties.canvasSize.width * focusScale;\n    baseRect.height = lsrImage.properties.canvasSize.height * focusScale;\n    baseRect.x =\n      focusOffset.x + (lsrImage.properties.canvasCentre.x * focusScale) - (baseRect.width * 0.5 + panOffset.x);\n    baseRect.y =\n      focusOffset.y + (lsrImage.properties.canvasCentre.y * focusScale) - (baseRect.height * 0.5 + panOffset.y);\n    baseRect.width /= lsrImage.canvasResizeRatio;\n    baseRect.height /= lsrImage.canvasResizeRatio;\n    baseRect.x /= lsrImage.canvasResizeRatio;\n    baseRect.y /= lsrImage.canvasResizeRatio;\n\n    //add the highlight\n    if (lsrHighlightImage !== null && (lsrImage.focussed || !lsrImage.zoomEnabled)) {\n      let x = lsrImage.focussedSize.width * ((1 - relX) * 0.5) - lsrImage.focussedSize.width * 0.5;\n      let y = lsrImage.focussedSize.height * ((1 - relY) * 0.5) - lsrImage.focussedSize.width * 0.6;\n      lsrImage.ctx.drawImage(\n        lsrHighlightImage,\n        x / lsrImage.canvasResizeRatio,\n        y / lsrImage.canvasResizeRatio,\n        lsrImage.focussedSize.width / lsrImage.canvasResizeRatio,\n        lsrImage.focussedSize.width / lsrImage.canvasResizeRatio);\n    }\n\n    //finally we draw our frame and crop\n    if (lsrImage.roundedCorners) {\n      let radius = 10;\n      lsrImage.ctx.fillStyle = '#fff';\n      lsrImage.ctx.globalCompositeOperation = 'destination-in';\n      lsrImage.ctx.beginPath();\n      lsrImage.ctx.moveTo(baseRect.x + radius, baseRect.y);\n      lsrImage.ctx.lineTo(baseRect.x + baseRect.width - radius, baseRect.y);\n      lsrImage.ctx.quadraticCurveTo(baseRect.x + baseRect.width, baseRect.y, baseRect.x + baseRect.width,\n        baseRect.y + radius);\n      lsrImage.ctx.lineTo(baseRect.x + baseRect.width, baseRect.y + baseRect.height - radius);\n      lsrImage.ctx.quadraticCurveTo(baseRect.x + baseRect.width, baseRect.y + baseRect.height,\n        baseRect.x + baseRect.width - radius, baseRect.y + baseRect.height);\n      lsrImage.ctx.lineTo(baseRect.x + radius, baseRect.y + baseRect.height);\n      lsrImage.ctx.quadraticCurveTo(baseRect.x, baseRect.y + baseRect.height, baseRect.x,\n        baseRect.y + baseRect.height - radius);\n      lsrImage.ctx.lineTo(baseRect.x, baseRect.y + radius);\n      lsrImage.ctx.quadraticCurveTo(baseRect.x, baseRect.y, baseRect.x + radius, baseRect.y);\n      lsrImage.ctx.closePath();\n      lsrImage.ctx.fill();\n    } else {\n      lsrImage.ctx.fillStyle = '#fff';\n      lsrImage.ctx.globalCompositeOperation = 'destination-in';\n      lsrImage.ctx.beginPath();\n      lsrImage.ctx.rect(baseRect.x, baseRect.y, baseRect.width, baseRect.height);\n      lsrImage.ctx.closePath();\n      lsrImage.ctx.fill();\n    }\n\n    //add some shadows\n    if (lsrImage.drawShadows) {\n      lsrImage.shadowCtx.clearRect(0, 0, lsrImage.canvasSize.width / lsrImage.canvasResizeRatio,\n        lsrImage.canvasSize.height / lsrImage.canvasResizeRatio);\n\n      let indent = 10;\n      let shadowSize = (lsrImage.focussed || !lsrImage.zoomEnabled) ? lsrShadowPadding * 0.5 : lsrShadowPadding * 0.25;\n      lsrImage.shadowCtx.beginPath();\n      lsrImage.shadowCtx.fillStyle = '#000';\n      lsrImage.shadowCtx.rect(baseRect.x + indent * 0.5, baseRect.y + indent * 0.5, baseRect.width - indent,\n        baseRect.height - indent);\n      lsrImage.shadowCtx.shadowBlur = shadowSize;\n      lsrImage.shadowCtx.shadowColor = lsrImage.focussed ? '#666' : '#999';\n      lsrImage.shadowCtx.shadowOffsetX = 0;\n      lsrImage.shadowCtx.shadowOffsetY = (shadowSize * 0.5);\n      lsrImage.shadowCtx.closePath();\n      lsrImage.shadowCtx.fill();\n\n      lsrImage.ctx.globalCompositeOperation = 'destination-over';\n      lsrImage.ctx.drawImage(lsrImage.shadowCanvas, 0, 0);\n    }\n  }\n\n  function removeLsrImage (element) {\n    let index = lsrImages.findIndex(lsrImage => { return lsrImage.canvas.parentElement === element; });\n    if (index !== -1) {\n      element.removeChild(lsrImages[index].canvas);\n      lsrImages.splice(index, 1);\n    }\n  }\n\n\n  return {\n    setHighlightImage: function (imgPath) {\n      lsrHighlightImagePath = imgPath;\n    },\n    load: function (elementOrId) {\n      load(elementOrId);\n    },\n    onload: function (callback) {\n      if (callback !== null && callback !== undefined) {\n        onloadCallback = callback;\n      } else {\n        onloadCallback = emptyOnload;\n      }\n    },\n    version: version,\n  };\n\n}\n"],"names":["falsy","isTrue","value","test","getWidth","element","getBoundingClientRect","width","parseInt","window","getComputedStyle","getHeight","height","LSRImg","loadOnDemand","lsrImages","lsrImgElements","lsrHighlightImagePath","focussedLsrCanvas","lsrHighlightImage","highlightImage","lsrShadowPadding","lsrFocussedPadding","lsrResizeTimer","lsrMinAngleX","lsrMinAngleY","lsrAngleYCorrector","lsrAngleRange","lsrDeviceOrientation","lsrAxisTable","y","z","landscapeInverse","portrait","onloadCallback","emptyOnload","Image","src","DeviceOrientationEvent","addEventListener","lsrOrientationChange","lsrOrientationUpdate","onresize","setTimeout","resizeLSRCanvases","onreadystatechange","document","readyState","getElementsByClassName","lsrImgElement","load","elementOrId","lsrElement","getElementById","log","indexOf","push","i","length","responsive","canvas","parentElement","resizeLSRCanvas","lsrImage","ratio","canvasSize","style","loadLSRFile","dataAttribute","dataset","imageSrc","filename","String","filePath","location","substr","lastIndexOf","xhr","XMLHttpRequest","open","responseType","onload","status","fileBlob","Blob","response","type","rounded","roundedCorners","shadows","drawShadows","animate","zoom","zoomEnabled","DONE","send","unzipLSRFile","blob","successCallback","loadAsync","then","zip","file","async","success","content","JSON","parse","layersLoading","layers","console","error","message","openLSRLayer","lsrImageLayer","json","info","properties","openLSRImageSet","entryName","images","openImage","lsrLayerImage","ext","match","mimeType","fileData","displayLSRImage","canvasResizeRatio","wRatio","hRatio","createElement","setAttribute","shadowCanvas","shadowCtx","getContext","canvasCentre","x","focussedSize","unfocussedSize","unfocusedReduction","aspectRatio","focussedScale","unfocussedScale","focussedOffset","unfocussedOffset","ctx","loadCount","img","appendChild","placeholder","display","animateLSRImage","Date","getTime","onmouseenter","focussed","removeEventListener","mouseMoveOverFocusedLSRImage","onmousemove","onmouseleave","requestLSRAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","startTime","time","theta","relX","Math","cos","relY","sin","rotateAroundX","rotateAroundY","panX","panY","resetLSRCanvasRotation","lsrClamp","val","min","max","orientation","e","n","parentRect","pageX","left","pageY","top","rotateLSRCanvas","degreeX","degreeY","perspective","parentCSS","canvasCSS","drawLSRImage","clearRect","globalCompositeOperation","focusScale","focusOffset","scalePerLayer","sizeScale","panOffset","distfromCenter","drawImage","baseRect","radius","fillStyle","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fill","rect","indent","shadowSize","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","removeLsrImage","index","findIndex","removeChild","splice","imgPath","undefined","version"],"mappings":"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"}